<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Project</title>
    <link rel="stylesheet" href="phase4.css">
</head>
<body>

   <h1>Project Phase 4</h1>






    <footer>
        <p>Made by: Sereen Saaida, Manas Patel, Jayda Pizzuco</p>
    </footer>

    <script>
        let isRunning = false;
        let emailSent = false; // Track if an email was already sent
        let circle = document.querySelector('.circle');
    
        /**
         * Starts the fan by setting the isRunning flag to true, 
         * setting the fan's rotation to 0 degrees, and 
         * setting up an interval timer to rotate the fan every 16 milliseconds.
         */
        const startFan = () => {
            isRunning = true;
            rotation = 0;
            timer = setInterval(() => {
                rotation += 12;
                circle.style.transform = `rotate(${rotation}deg)`;
            }, 16);
        };
    

/**
 * Stops the fan by clearing the interval timer, 
 * resetting the rotation of the fan circle to 0 degrees,
 * and updating the isRunning flag.
 */
        const stopFan = () => {
            isRunning = false;
            clearInterval(timer);
            circle.style.transform = 'rotate(0deg)';
        };
    
        /**
         * Updates the fan status based on the received fan status from the server.
         * If the fan status is "on" and the fan is not running, start the fan.
         * If the fan status is "off" and the fan is running, stop the fan.
         * @param {string} fanStatus - The fan status from the server, either "on" or "off".
         */
        function updateFanStatus(fanStatus) {
            if (fanStatus === "on" && !isRunning) {
                startFan();
            } else if (fanStatus === "off" && isRunning) {
                stopFan();
            }
        }
        
/*************  ✨ Codeium Command ⭐  *************/
/**
 * Fetches temperature and humidity data from the server and updates the UI.
 * - Updates the text content of temperature and humidity elements.
 * - Checks if the temperature exceeds 24°C to trigger an email.
 * - Updates the fan status based on the server response.
 * - Adjusts the stroke dash array of temperature and humidity arcs to visually
 *   represent the current values.
 */
/******  d80a65d5-92e3-4a51-8983-5399e0bad0ec  *******/    

        function checkTemperature() {
            fetch('/checktemperature') 
                .then(response => response.json())
                .then(data => {
                    const temperatureArc = document.querySelector("#temperature-gauge svg path");
                    const humidityArc = document.querySelector("#humidity-gauge svg path");
    
                    document.querySelector("#temperature").textContent = data.temperature;
                    document.querySelector("#humidity").textContent = data.humidity;
    
                    if (parseFloat(data.temperature) > 24.0 && !emailSent) {
                        emailSent = true;
                        sendEmail();
                    } else if (parseFloat(data.temperature) <= 24.0) {
                        emailSent = false;
                    }
    
                    // updateFanStatus(data.fan_status);
    
                    const temperatureArcLength = temperatureArc.getTotalLength();
                    const humidityArcLength = humidityArc.getTotalLength();
    
                    const tempMax = 40; 
                    const tempMin = 0;  
                    const humidityMax = 100; 
                    const humidityMin = 0; 
    
                    const tempStep = temperatureArcLength / (tempMax - tempMin);
                    const humidityStep = humidityArcLength / (humidityMax - humidityMin);
    
                    const temperatureValue = (data.temperature - tempMin) * tempStep;
                    const humidityValue = (data.humidity - humidityMin) * humidityStep;
    
                    temperatureArc.style.strokeDasharray = `${temperatureValue} ${temperatureArcLength - temperatureValue}`;
                    humidityArc.style.strokeDasharray = `${humidityValue} ${humidityArcLength - humidityValue}`;
                });
        }
    
/**
 * Sends a request to the server to trigger an email sending process.
 * Upon receiving a response, updates the fan status based on the 
 * 'fan_status' field in the returned data.
 */
        function sendEmail() {
            fetch('/sendemail')
            .then(response => response.json())
            .then(data => {
                if (data.fan_status) {
                    updateFanStatus(data.fan_status);
                }
            });
        }
    
        setInterval(checkTemperature, 1000);
    
        window.onload = checkTemperature;
    </script>
    

</body>
</html>
