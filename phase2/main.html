<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Project</title>
    <link rel="stylesheet" href="fan.css">
</head>
<body>
    <h1>Project Phase 2</h1>

<!--gauge containers, one gauge for temperatue and one for humidity, beginning with value of 0, value gets modified as
temperature is changed, which how much the gauge is filled-->
    <div class="gauge-container">
        <div id="temperature-gauge" class="gauge" style="--value: 0%;">
            <span class="gauge-label" id="temperature-label">Loading Temperature</span>
        </div>
        <div id="humidity-gauge" class="gauge" style="--value: 0%;">
            <span class="gauge-label" id="humidity-label">Loading humidity</span>
        </div>
    </div>

    <div class="fan">
        <img src="https://image.ibb.co/faCpXk/fangrid.png" class="grid" />
        <div class="circle"></div>
        <div class="body"></div>
        <button class="onOff">Turn On</button>
        <div class="bottom"></div>
    </div>

    <footer>
        <p>Made by: Sereen Saaida, Manas Patel, Jayda Pizzuco</p>
    </footer>

    <script>
        const circle = document.querySelector(".circle");
        const button = document.querySelector(".onOff");
        let isRunning = false;
        let rotation = 0; // Tracking rotation angles

        const startFan = () => {
            isRunning = true;
            button.textContent = "Turn Off";
            rotation = 0; // Reset rotation
           
            // Start spinning the fan
            timer = setInterval(() => {
                rotation += 12; // rotation angle
                circle.style.transform = `rotate(${rotation}deg)`; // Apply rotation
            }, 16);
        };

        const stopFan = () => {
            isRunning = false;
            button.textContent = "Turn On";
            clearInterval(timer); // Stop the spin
            circle.style.transform = 'rotate(0deg)'; // Reset rotation
        };

        button.addEventListener('click', () => {
            if (isRunning) {
                stopFan();
            } else {
                startFan();
            }
        });


        //function to call the check temperature methods on the Flask app and retrieve the temp and humidity
       // an email will also be sent to the user if the temperature is > 24
       //currently the email is hardcoded TODO: allow user to enter email??
       function checkTemperature() {
            fetch('/checktemperature')
            .then(response => response.json())
            .then(data => {
                const temperatureValue = data.temperature;
                const humidityValue = data.humidity;

                //selecting temperature gauge and setting value of current temperature
                document.getElementById("temperature-gauge").style.setProperty("--value", `${temperatureValue}%`);
                document.getElementById("temperature-label").textContent = `${temperatureValue}Â°C`;

                //selecting humidty gauge and setting value of current temperature
                document.getElementById("humidity-gauge").style.setProperty("--value", `${humidityValue}%`);
                document.getElementById("humidity-label").textContent = `${humidityValue}%`;
            });
        }

        window.onload = checkTemperature;
    </script>

</body>
</html>
